---
title: 'Creating Custom Agents'
---

# Creating Custom Agents

Build custom agents through the API or auto-generate them from natural language prompts.

## Quick Start

Create an agent in three steps:

<Steps>
  <Step title="Define Agent Attributes">
    Specify the agent's role, goal, backstory, and system instructions
  </Step>

  <Step title="Configure Tasks">
    Add 1-5 tasks with tools and expected outputs
  </Step>

  <Step title="Submit">
    POST to the API or use auto-generation from a prompt
  </Step>
</Steps>

## Method 1: Manual Creation

### Agent Attributes

Define who your agent is and what it does:

**Role** (required)
- Professional function or expertise area
- Examples: "Senior Python Developer", "Security Auditor", "Code Reviewer"

**Goal** (required)
- Primary objective the agent aims to achieve
- Be specific and measurable
- Examples: "Optimize database queries for performance", "Identify SQL injection vulnerabilities"

**Backstory** (required)
- Professional context that establishes credibility
- Guides decision-making and reasoning style
- Include relevant experience, methodology, or principles

**System Prompt** (required)
- High-level instructions for task execution
- Output format requirements
- Guidelines for handling edge cases

### Task Configuration

Each agent requires 1-5 tasks. Each task includes:

**Description** (required)
```
Clear statement of what the task accomplishes.
Focus on the outcome, not implementation details.
The LLM will enhance this with step-by-step reasoning.
```

**Tools** (required, array of tool IDs)
```python
["[ask_knowledge_graph_queries](/agents/tools-reference#knowledge-graph-tools)", "[get_code_from_probable_node_name](/agents/tools-reference#knowledge-graph-tools)"]
```

Select from 60+ available tools. See [Tools Reference](/agents/tools-reference) for the complete list.

**Expected Output** (required, JSON object)
```json
{
  "format": "markdown",
  "sections": ["summary", "findings", "recommendations"]
}
```

**MCP Servers** (optional)
```python
[
  {"name": "github", "link": "https://github.com/mcp-servers/github"},
  {"name": "postgres", "link": "https://github.com/mcp-servers/postgres"}
]
```

### Complete Example

<CodeGroup>
```python Python
import requests

# Create custom agent
response = requests.post(
    "https://production-api.potpie.ai/api/v1/custom-agents/agents/",
    headers={"Authorization": "Bearer <your_token>"},
    json={
        "role": "Senior Python Security Auditor",
        "goal": "Identify and document security vulnerabilities in Python code",
        "backstory": "Expert in OWASP Top 10, secure coding practices, and Python security patterns. Specializes in finding SQL injection, XSS, and authentication issues.",
        "system_prompt": "Analyze code for security vulnerabilities. Provide severity ratings (Critical/High/Medium/Low) and remediation steps. Focus on OWASP Top 10 categories.",
        "tasks": [
            {
                "description": "Scan codebase for SQL injection vulnerabilities in database query construction",
                "tools": [
                    "[ask_knowledge_graph_queries](/agents/tools-reference#knowledge-graph-tools)",
                    "[get_code_from_probable_node_name](/agents/tools-reference#knowledge-graph-tools)",
                    "[get_code_from_multiple_node_ids](/agents/tools-reference#knowledge-graph-tools)"
                ],
                "mcp_servers": [],
                "expected_output": {
                    "format": "markdown",
                    "sections": ["vulnerabilities_found", "severity", "remediation"]
                }
            },
            {
                "description": "Check authentication and authorization implementations for security flaws",
                "tools": [
                    "[ask_knowledge_graph_queries](/agents/tools-reference#knowledge-graph-tools)",
                    "[get_nodes_from_tags](/agents/tools-reference#knowledge-graph-tools)"
                ],
                "mcp_servers": [],
                "expected_output": {
                    "format": "markdown",
                    "sections": ["auth_findings", "recommendations"]
                }
            }
        ]
    }
)

agent = response.json()
print(f"Created agent: {agent['id']}")
```

```javascript JavaScript
const response = await fetch(
  'https://production-api.potpie.ai/api/v1/custom-agents/agents/',
  {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer <your_token>',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      role: 'Senior Python Security Auditor',
      goal: 'Identify and document security vulnerabilities in Python code',
      backstory: 'Expert in OWASP Top 10, secure coding practices, and Python security patterns.',
      system_prompt: 'Analyze code for security vulnerabilities. Provide severity ratings.',
      tasks: [
        {
          description: 'Scan codebase for SQL injection vulnerabilities',
          tools: ['[ask_knowledge_graph_queries](/agents/tools-reference#knowledge-graph-tools)', '[get_code_from_probable_node_name](/agents/tools-reference#knowledge-graph-tools)'],
          mcp_servers: [],
          expected_output: {
            format: 'markdown',
            sections: ['vulnerabilities_found', 'severity', 'remediation']
          }
        }
      ]
    })
  }
);

const agent = await response.json();
console.log(`Created agent: ${agent.id}`);
```

```bash cURL
curl -X POST https://production-api.potpie.ai/api/v1/custom-agents/agents/ \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "role": "Senior Python Security Auditor",
    "goal": "Identify and document security vulnerabilities in Python code",
    "backstory": "Expert in OWASP Top 10, secure coding practices.",
    "system_prompt": "Analyze code for security vulnerabilities.",
    "tasks": [
      {
        "description": "Scan codebase for SQL injection vulnerabilities",
        "tools": ["[ask_knowledge_graph_queries](/agents/tools-reference#knowledge-graph-tools)"],
        "mcp_servers": [],
        "expected_output": {
          "format": "markdown",
          "sections": ["vulnerabilities_found"]
        }
      }
    ]
  }'
```
</CodeGroup>

### Response Format

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "user_id": "user_123",
  "role": "Senior Python Security Auditor",
  "goal": "Identify and document security vulnerabilities",
  "backstory": "Expert in OWASP Top 10...",
  "system_prompt": "Analyze code for security vulnerabilities...",
  "tasks": [
    {
      "id": 1,
      "description": "Scan codebase for SQL injection...",
      "tools": ["[ask_knowledge_graph_queries](/agents/tools-reference#knowledge-graph-tools)"],
      "mcp_servers": [],
      "expected_output": {...}
    }
  ],
  "visibility": "private",
  "deployment_status": "STOPPED",
  "created_at": "2024-02-15T10:30:00Z",
  "updated_at": "2024-02-15T10:30:00Z"
}
```

## Method 2: Auto-Generation

Generate complete agents from natural language prompts:

<CodeGroup>
```python Python
response = requests.post(
    "https://production-api.potpie.ai/api/v1/custom-agents/agents/auto/",
    headers={"Authorization": "Bearer <your_token>"},
    json={
        "prompt": "Create an agent that reviews Python code for performance issues and suggests optimizations"
    }
)

agent = response.json()
```

```javascript JavaScript
const response = await fetch(
  'https://production-api.potpie.ai/api/v1/custom-agents/agents/auto/',
  {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer <your_token>',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      prompt: 'Create an agent that reviews Python code for performance issues'
    })
  }
);
```
</CodeGroup>

### How Auto-Generation Works

1. **Prompt Analysis**
   - LLM analyzes your natural language prompt
   - Identifies key components and requirements
   - Maps to available tools

2. **Agent Design**
   - Generates appropriate role and backstory
   - Creates optimized goal statement
   - Designs task breakdown

3. **Tool Selection**
   - Recommends optimal tools based on task
   - Includes reasoning for tool choices
   - Validates tool availability

4. **Enhancement**
   - Adds step-by-step reasoning prompts
   - Injects validation strategies
   - Optimizes for your use case

The generated agent is immediately ready to useâ€”you can execute it or modify any attributes.

## Task Limits & Validation

**Constraints:**
- Minimum: 1 task required
- Maximum: 5 tasks per agent
- Each task must have at least 1 tool
- Tool IDs validated against available tools
- Invalid tools rejected with 400 error

**Best Practices:**
- Start with 1-2 tasks for simpler agents
- Use 3-5 tasks for complex workflows
- Group related operations in single task
- Keep task descriptions focused and clear

## Managing Agents

### Update Agent

```python
PUT /api/v1/custom-agents/agents/{agent_id}
{
  "role": "Updated role",
  "tasks": [...]  # Full tasks array required
}
```

### Delete Agent

```python
DELETE /api/v1/custom-agents/agents/{agent_id}
```

### Get Agent Details

```python
GET /api/v1/custom-agents/agents/{agent_id}
```

### List All Accessible Agents

```python
GET /api/v1/custom-agents/agents/?include_public=true&include_shared=true
```

## Sharing & Permissions

### Change Visibility

**Make Public:**
```python
POST /api/v1/custom-agents/agents/share
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "visibility": "public"
}
```

**Make Private:**
```python
POST /api/v1/custom-agents/agents/share
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "visibility": "private"
}
```

### Share with Specific User

```python
POST /api/v1/custom-agents/agents/share
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "shared_with_email": "colleague@company.com"
}
```

This creates a share record and updates visibility to "shared" if it was "private".

### Revoke Access

```python
POST /api/v1/custom-agents/agents/revoke-access
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "user_email": "colleague@company.com"
}
```

### List Shared Users

```python
GET /api/v1/custom-agents/agents/{agent_id}/shares
```

Returns:
```json
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "shared_with": ["colleague@company.com", "teammate@company.com"]
}
```

## Using Agents in Conversations

Once created, use your agent through the Conversations API:

<Steps>
  <Step title="Create Conversation">
    ```python
    POST /api/v1/conversations/
    {
      "user_id": "user_123",
      "agent_ids": ["your_custom_agent_id"],
      "project_ids": ["project_id"]
    }
    ```
  </Step>

  <Step title="Send Message">
    ```python
    POST /api/v1/conversations/{conversation_id}/message/
    data={
      "content": "Your query for the custom agent"
    }
    ```
  </Step>

  <Step title="Receive Streaming Response">
    Agent executes tasks with selected tools and streams results with citations
  </Step>
</Steps>

## Error Handling

**Common Errors:**

| Status | Error | Solution |
|--------|-------|----------|
| 400 | Invalid tool IDs | Check tool IDs against [available tools](/agents/tools-reference) |
| 400 | Task validation failed | Ensure 1-5 tasks, each with description and tools |
| 403 | Permission denied | Verify you own the agent or have shared access |
| 404 | Agent not found | Check agent_id is correct |

## Next Steps

<CardGroup cols={2}>
  <Card title="Explore Available Tools" icon="wrench" href="/agents/tools-reference">
    60+ tools for code analysis and generation
  </Card>
  <Card title="API Reference" icon="code" href="/api-reference/agents">
    Complete API endpoint documentation
  </Card>
</CardGroup>
