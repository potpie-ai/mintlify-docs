---
title: 'Creating Custom Agents'
---

Build custom agents through the API or auto-generate them from natural language prompts.

## Quick Start

Create an agent in three steps:

<Steps>
  <Step title="Define Agent Attributes">
    Specify the agent's role, goal, backstory, and system instructions
  </Step>

  <Step title="Configure Tasks">
    Add 1-5 tasks with tools and expected outputs
  </Step>

  <Step title="Submit">
    POST to the API or use auto-generation from a prompt
  </Step>
</Steps>

## Method 1: Manual Creation

### Agent Attributes

Define who your agent is and what it does. All four attributes are required to create a functional agent.

#### Role
Professional function or expertise area that defines the agent's identity.

<Tip>
Use specific, descriptive roles like "Senior Python Developer", "Security Auditor", or "Code Reviewer" rather than generic titles.
</Tip>

**Examples:**
- "Senior Python Developer"
- "Security Auditor"
- "Code Reviewer"

#### Goal
Primary objective the agent aims to achieve. Be specific and measurable.

**Examples:**
- "Optimize database queries for performance"
- "Identify SQL injection vulnerabilities"
- "Refactor legacy code to modern patterns"

#### Backstory
Professional context that establishes credibility and guides decision-making.

Include relevant experience, methodology, or principles that inform how the agent approaches tasks.

<img src="/images/custom-agent-identity.png" alt="Configure agent role, goal, and backstory" />

#### System Prompt
High-level instructions that control task execution behavior.

Define output format requirements, edge case handling guidelines, and quality standards.

<img src="/images/custom-agent-system-prompt.png" alt="System prompt configuration" />

### Task Configuration

Each agent requires **1-5 tasks**. Each task defines a specific action the agent can perform.

#### Description

Clear statement of what the task accomplishes, focused on outcomes rather than implementation details.

<Info>
The LLM automatically enhances task descriptions with step-by-step reasoning to improve execution quality.
</Info>

**Example:**
```
Scan codebase for SQL injection vulnerabilities in database query construction
```

#### Tools

Array of tool IDs that the agent can use to complete this task.

<Warning>
Each task must have at least one tool. Tool IDs must match exactly from the [Tools Reference](/agents/tools-reference).
</Warning>

**Example:**
```python
["ask_knowledge_graph_queries", "get_code_from_probable_node_name"]
```

Select from 60+ available tools. See [Tools Reference](/agents/tools-reference) for the complete list.

<img src="/images/custom-agent-tools.png" alt="Select tools for your agent" />

#### Expected Output

JSON object defining the format and structure of task results.

**Example:**
```json
{
  "format": "markdown",
  "sections": ["summary", "findings", "recommendations"]
}
```

<Tip>
Structure your expected output to match your downstream processing needs. Well-defined sections make it easier to parse agent responses programmatically.
</Tip>

#### MCP Servers (Optional)

Model Context Protocol servers that provide additional capabilities beyond built-in tools.

**Example:**
```python
[
  {"name": "github", "link": "https://github.com/mcp-servers/github"},
  {"name": "postgres", "link": "https://github.com/mcp-servers/postgres"}
]
```

### Complete Example

<CodeGroup>
```python Python
import requests

# Create custom agent
response = requests.post(
    "https://production-api.potpie.ai/api/v1/custom-agents/agents/",
    headers={"Authorization": "Bearer <your_token>"},
    json={
        "role": "Senior Python Security Auditor",
        "goal": "Identify and document security vulnerabilities in Python code",
        "backstory": "Expert in OWASP Top 10, secure coding practices, and Python security patterns. Specializes in finding SQL injection, XSS, and authentication issues.",
        "system_prompt": "Analyze code for security vulnerabilities. Provide severity ratings (Critical/High/Medium/Low) and remediation steps. Focus on OWASP Top 10 categories.",
        "tasks": [
            {
                "description": "Scan codebase for SQL injection vulnerabilities in database query construction",
                "tools": [
                    "ask_knowledge_graph_queries",
                    "get_code_from_probable_node_name",
                    "get_code_from_multiple_node_ids"
                ],
                "mcp_servers": [],
                "expected_output": {
                    "format": "markdown",
                    "sections": ["vulnerabilities_found", "severity", "remediation"]
                }
            },
            {
                "description": "Check authentication and authorization implementations for security flaws",
                "tools": [
                    "ask_knowledge_graph_queries",
                    "get_nodes_from_tags"
                ],
                "mcp_servers": [],
                "expected_output": {
                    "format": "markdown",
                    "sections": ["auth_findings", "recommendations"]
                }
            }
        ]
    }
)

agent = response.json()
print(f"Created agent: {agent['id']}")
```

```javascript JavaScript
const response = await fetch(
  'https://production-api.potpie.ai/api/v1/custom-agents/agents/',
  {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer <your_token>',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      role: 'Senior Python Security Auditor',
      goal: 'Identify and document security vulnerabilities in Python code',
      backstory: 'Expert in OWASP Top 10, secure coding practices, and Python security patterns.',
      system_prompt: 'Analyze code for security vulnerabilities. Provide severity ratings.',
      tasks: [
        {
          description: 'Scan codebase for SQL injection vulnerabilities',
          tools: ['ask_knowledge_graph_queries', 'get_code_from_probable_node_name'],
          mcp_servers: [],
          expected_output: {
            format: 'markdown',
            sections: ['vulnerabilities_found', 'severity', 'remediation']
          }
        }
      ]
    })
  }
);

const agent = await response.json();
console.log(`Created agent: ${agent.id}`);
```

```bash cURL
curl -X POST https://production-api.potpie.ai/api/v1/custom-agents/agents/ \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "role": "Senior Python Security Auditor",
    "goal": "Identify and document security vulnerabilities in Python code",
    "backstory": "Expert in OWASP Top 10, secure coding practices.",
    "system_prompt": "Analyze code for security vulnerabilities.",
    "tasks": [
      {
        "description": "Scan codebase for SQL injection vulnerabilities",
        "tools": ["ask_knowledge_graph_queries"],
        "mcp_servers": [],
        "expected_output": {
          "format": "markdown",
          "sections": ["vulnerabilities_found"]
        }
      }
    ]
  }'
```
</CodeGroup>

### Response Format

Successful agent creation returns a complete agent object with generated IDs and metadata:

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "user_id": "user_123",
  "role": "Senior Python Security Auditor",
  "goal": "Identify and document security vulnerabilities",
  "backstory": "Expert in OWASP Top 10...",
  "system_prompt": "Analyze code for security vulnerabilities...",
  "tasks": [
    {
      "id": 1,
      "description": "Scan codebase for SQL injection...",
      "tools": ["ask_knowledge_graph_queries"],
      "mcp_servers": [],
      "expected_output": {...}
    }
  ],
  "visibility": "private",
  "deployment_status": "STOPPED",
  "created_at": "2024-02-15T10:30:00Z",
  "updated_at": "2024-02-15T10:30:00Z"
}
```

## Method 2: Auto-Generation

Generate complete agents from natural language prompts. The system analyzes your description and automatically creates an optimized agent with appropriate tools and tasks.

<img src="/images/custom-agent-create.png" alt="Describe your agent in natural language" />

<CodeGroup>
```python Python
response = requests.post(
    "https://production-api.potpie.ai/api/v1/custom-agents/agents/auto/",
    headers={"Authorization": "Bearer <your_token>"},
    json={
        "prompt": "Create an agent that reviews Python code for performance issues and suggests optimizations"
    }
)

agent = response.json()
```

```javascript JavaScript
const response = await fetch(
  'https://production-api.potpie.ai/api/v1/custom-agents/agents/auto/',
  {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer <your_token>',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      prompt: 'Create an agent that reviews Python code for performance issues'
    })
  }
);
```
</CodeGroup>

### How Auto-Generation Works

The system follows a four-step process to transform your prompt into a complete agent:

<Steps>
  <Step title="Prompt Analysis">
    LLM analyzes your natural language prompt, identifies key components and requirements, and maps them to available tools
  </Step>

  <Step title="Agent Design">
    Generates appropriate role and backstory, creates optimized goal statement, and designs intelligent task breakdown
  </Step>

  <Step title="Tool Selection">
    Recommends optimal tools based on task requirements, includes reasoning for tool choices, and validates tool availability
  </Step>

  <Step title="Enhancement">
    Adds step-by-step reasoning prompts, injects validation strategies, and optimizes for your specific use case
  </Step>
</Steps>

<Info>
The generated agent is immediately ready to use. You can execute it as-is or modify any attributes to fine-tune behavior.
</Info>

## Task Limits & Validation

### Constraints

All custom agents must adhere to these validation rules:

| Constraint | Requirement |
|------------|-------------|
| Minimum tasks | 1 task required |
| Maximum tasks | 5 tasks per agent |
| Tools per task | At least 1 tool required |
| Tool validation | IDs must match available tools |
| Invalid tools | Rejected with 400 error |

<Warning>
Invalid tool IDs will cause agent creation to fail. Always verify tool names against the [Tools Reference](/agents/tools-reference) before submission.
</Warning>
## Managing Agents

View and manage all your custom agents in the Custom Agents section.

<img src="/images/custom-agent-list.png" alt="Custom agents list" />

### Update Agent

Modify any agent attribute or task configuration. The entire tasks array must be provided when updating.

```python
PUT /api/v1/custom-agents/agents/{agent_id}
{
  "role": "Updated role",
  "goal": "Updated goal",
  "tasks": [...]  # Full tasks array required
}
```

<Warning>
Updates require the complete tasks array. Partial updates are not supported - always include all tasks.
</Warning>

### Delete Agent

Permanently remove an agent and all associated configurations.

```python
DELETE /api/v1/custom-agents/agents/{agent_id}
```

### Get Agent Details

Retrieve the complete configuration for a specific agent.

```python
GET /api/v1/custom-agents/agents/{agent_id}
```

### List All Accessible Agents

Query all agents you have access to, including public and shared agents.

```python
GET /api/v1/custom-agents/agents/?include_public=true&include_shared=true
```

<Tip>
Use query parameters to filter results: `include_public=true` for community agents, `include_shared=true` for team-shared agents.
</Tip>

## Sharing & Permissions

Control who can access and use your custom agents through visibility settings and explicit sharing.

### Change Visibility

#### Make Public

Allow all users to discover and use your agent.

```python
POST /api/v1/custom-agents/agents/share
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "visibility": "public"
}
```

#### Make Private

Restrict access to only yourself and explicitly shared users.

```python
POST /api/v1/custom-agents/agents/share
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "visibility": "private"
}
```

### Share with Specific User

Grant access to individual team members by email address.

```python
POST /api/v1/custom-agents/agents/share
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "shared_with_email": "colleague@company.com"
}
```

<Info>
Sharing with a specific user automatically updates visibility to "shared" if it was previously "private".
</Info>

### Revoke Access

Remove a user's access to a shared agent.

```python
POST /api/v1/custom-agents/agents/revoke-access
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "user_email": "colleague@company.com"
}
```

### List Shared Users

View all users who have access to a specific agent.

```python
GET /api/v1/custom-agents/agents/{agent_id}/shares
```

**Response:**
```json
{
  "agent_id": "550e8400-e29b-41d4-a716-446655440000",
  "shared_with": ["colleague@company.com", "teammate@company.com"]
}
```

## Using Agents in Conversations

Once created, execute your custom agent through the Conversations API to process queries and generate responses.

<Steps>
  <Step title="Create Conversation">
    Initialize a conversation with your custom agent
    ```python
    POST /api/v1/conversations/
    {
      "user_id": "user_123",
      "agent_ids": ["your_custom_agent_id"],
      "project_ids": ["project_id"]
    }
    ```
  </Step>

  <Step title="Send Message">
    Submit your query to the agent
    ```python
    POST /api/v1/conversations/{conversation_id}/message/
    data={
      "content": "Your query for the custom agent"
    }
    ```
  </Step>

  <Step title="Receive Streaming Response">
    Agent executes tasks with selected tools and streams results with citations
  </Step>
</Steps>

## Error Handling

Understanding and resolving common errors when working with custom agents.

### Common Error Responses

<AccordionGroup>
  <Accordion title="400 - Invalid Tool IDs" icon="wrench">
    **Error Message:**
    ```json
    {
      "error": "Invalid tool IDs provided",
      "invalid_tools": ["invalid_tool_name"]
    }
    ```

    **Cause:** One or more tool IDs in your task configuration don't match available tools.

    **Solution:**
    1. Check the [Tools Reference](/agents/tools-reference) for valid tool names
    2. Verify exact spelling and formatting
    3. Ensure tools haven't been deprecated
    4. Use auto-complete features when available

    <Warning>
    Tool IDs are case-sensitive and must match exactly. Common mistakes include typos, outdated tool names, or incorrect formatting.
    </Warning>
  </Accordion>

  <Accordion title="400 - Task Validation Failed" icon="list-check">
    **Error Message:**
    ```json
    {
      "error": "Task validation failed",
      "details": "Agent must have between 1 and 5 tasks"
    }
    ```

    **Cause:** Task configuration doesn't meet validation requirements.

    **Common Issues:**
    - No tasks provided (minimum 1 required)
    - More than 5 tasks (maximum 5 allowed)
    - Task missing required description field
    - Task missing tools array
    - Empty tools array (minimum 1 tool per task)

    **Solution:**
    1. Ensure 1-5 tasks are defined
    2. Each task must have a description
    3. Each task must have at least one valid tool
    4. Verify expected_output is properly formatted JSON

    <Tip>
    Review the Task Configuration section above for complete requirements and examples.
    </Tip>
  </Accordion>

  <Accordion title="403 - Permission Denied" icon="lock">
    **Error Message:**
    ```json
    {
      "error": "Permission denied",
      "message": "You do not have access to this agent"
    }
    ```

    **Cause:** Attempting to modify, delete, or access an agent you don't own or haven't been granted access to.

    **Solution:**
    1. Verify you're the agent owner
    2. Check if the agent was shared with you
    3. Confirm visibility settings (private/shared/public)
    4. Request access from the agent owner if needed

    <Info>
    Only agent owners can update or delete agents. Shared users have read and execute permissions only.
    </Info>
  </Accordion>

  <Accordion title="404 - Agent Not Found" icon="circle-question">
    **Error Message:**
    ```json
    {
      "error": "Agent not found",
      "agent_id": "550e8400-e29b-41d4-a716-446655440000"
    }
    ```

    **Cause:** The specified agent ID doesn't exist or has been deleted.

    **Solution:**
    1. Verify the agent_id is correct
    2. Check if the agent was deleted
    3. Confirm you have access to the agent
    4. List all accessible agents to find the correct ID

    **List Agents:**
    ```python
    GET /api/v1/custom-agents/agents/
    ```
  </Accordion>
</AccordionGroup>

### Error Response Format

All error responses follow a consistent structure:

```json
{
  "error": "Error type",
  "message": "Detailed error description",
  "details": "Additional context or specific field errors",
  "status_code": 400
}
```

### Debugging Tips

<CardGroup cols={2}>
  <Card title="Validate Locally" icon="check">
    Test tool IDs and task structure before submitting to catch errors early
  </Card>
  <Card title="Check Logs" icon="file-lines">
    Review API response details for specific field validation failures
  </Card>
  <Card title="Use Examples" icon="code">
    Start with working examples and modify incrementally
  </Card>
  <Card title="Test Permissions" icon="users">
    Verify access rights before attempting update or delete operations
  </Card>
</CardGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="Explore Available Tools" icon="wrench" href="/agents/tools-reference">
    60+ tools for code analysis and generation
  </Card>
  <Card title="API Reference" icon="code" href="/api-reference/agents">
    Complete API endpoint documentation
  </Card>
</CardGroup>
