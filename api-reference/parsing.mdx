---
title: 'Parsing'
description: 'Parse repositories and monitor parsing status'
---

# Parsing

Parse repositories to analyze and index your codebase, enabling AI agents to understand code structure and relationships.

---

## Parse Directory

**POST** `/api/v1/parse`

Initiate repository parsing to build the knowledge graph that powers AI agents.

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `repo_name` | string | optional* | Repository name (e.g., "facebook/react") |
| `repo_path` | string | optional* | Local or remote path to repository |
| `branch_name` | string | required | Branch to parse (e.g., "main") |

<Note>
  Either `repo_name` or `repo_path` must be provided. If both are provided, `repo_path` takes precedence.
</Note>

### Response

| Field | Type | Description |
|-------|------|-------------|
| `project_id` | string | Unique identifier to check parsing status |
| `status` | string | Current parsing state: `submitted` or `ready` |

### Example

```python
import requests

response = requests.post(
    'https://production-api.potpie.ai/api/v1/parse',
    headers={'Authorization': 'Bearer <token>'},
    json={
        'repo_name': 'my-ecommerce-api',
        'branch_name': 'main'
    }
)

project_id = response.json()['project_id']
```

---

## Get Parsing Status

**GET** `/api/v1/parsing-status/{project_id}`

Check the current parsing status of a repository using its project ID.

### Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `project_id` | string | Project ID from parse response |

### Response

| Field | Type | Description |
|-------|------|-------------|
| `status` | string | Current parsing state |
| `progress` | number | Completion percentage (0-100) |
| `message` | string | Descriptive message about current phase |

### Status Values

| Status | Description |
|--------|-------------|
| `pending` | Parsing queued but not started |
| `in_progress` | Active parsing |
| `ready` | Parsing finished successfully |
| `failed` | Parsing encountered errors |

### Status Phases

During parsing, you'll see different messages corresponding to analysis stages:

| Phase | Typical Message | Progress Range |
|-------|----------------|----------------|
| Initialization | "Initializing parser" | 0-10% |
| File Discovery | "Discovering source files" | 10-20% |
| Code Analysis | "Analyzing code structure" | 20-70% |
| Graph Building | "Building knowledge graph" | 70-90% |
| Finalization | "Finalizing analysis" | 90-100% |
| Complete | "Parsing ready" | 100% |

### Example Usage

<CodeGroup>

```typescript TypeScript
async function waitForParsingComplete(projectId: string): Promise<void> {
  const maxAttempts = 60; // 10 minutes with 10s intervals
  let attempts = 0;

  while (attempts < maxAttempts) {
    const response = await fetch(
      `https://production-api.potpie.ai/api/v1/parsing-status/${projectId}`,
      {
        headers: {
          'Authorization': 'Bearer <token>'
        }
      }
    );

    const data = await response.json();

    console.log(`Status: ${data.status} - ${data.message} (${data.progress}%)`);

    if (data.status === 'ready') {
      console.log('Parsing ready successfully!');
      return;
    }

    if (data.status === 'failed') {
      throw new Error(`Parsing failed: ${data.message}`);
    }

    await new Promise(resolve => setTimeout(resolve, 10000)); // Wait 10s
    attempts++;
  }

  throw new Error('Parsing timeout - took longer than expected');
}

// Usage
waitForParsingComplete('proj_456')
  .then(() => console.log('Ready to use agents!'))
  .catch(error => console.error(error));
```

```python Python
import requests
import time

def get_parsing_status(project_id: str) -> dict:
    """Get the current parsing status for a project."""
    response = requests.get(
        f'https://production-api.potpie.ai/api/v1/parsing-status/{project_id}',
        headers={'Authorization': 'Bearer <token>'}
    )
    return response.json()

def wait_for_parsing(project_id: str, timeout: int = 600):
    """
    Wait for parsing to complete with timeout.

    Args:
        project_id: The project ID to monitor
        timeout: Maximum time to wait in seconds (default 10 minutes)
    """
    start_time = time.time()

    while time.time() - start_time < timeout:
        status_data = get_parsing_status(project_id)

        print(f"Status: {status_data['status']}")
        print(f"Progress: {status_data['progress']}%")
        print(f"Message: {status_data['message']}")
        print("-" * 50)

        if status_data['status'] == 'ready':
            return True
        elif status_data['status'] == 'failed':
            raise Exception(f"Parsing failed: {status_data['message']}")

        time.sleep(10)

    raise TimeoutError(f"Parsing did not complete within {timeout} seconds")

# Usage
try:
    wait_for_parsing('proj_456')
    print("Project is ready!")
except Exception as e:
    print(f"Error: {e}")
```

```bash cURL
# Simple status check
curl -X GET \
  'https://production-api.potpie.ai/api/v1/parsing-status/proj_456' \
  -H 'Authorization: Bearer <token>'

# Continuous monitoring with watch (Linux/Mac)
watch -n 10 'curl -s -X GET \
  "https://production-api.potpie.ai/api/v1/parsing-status/proj_456" \
  -H "Authorization: Bearer <token>" | jq'
```

</CodeGroup>

---

## Get Parsing Status By Repo

**POST** `/api/v1/parsing-status`

Retrieve parsing status using repository name and branch instead of project ID.

### Use Cases

- Check parsing status when you only have repository details
- Query status before knowing the project ID
- Verify if a specific repo + branch combination has been parsed
- Monitor parsing for repositories with specific commit IDs

### Request Body

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `repo_name` | string | required | The name of your repository |
| `branch_name` | string | optional* | Branch name to check |
| `commit_id` | string | optional* | Specific commit ID to check |

<Note>
  Either `commit_id` or `branch_name` should be provided. If both are given, `commit_id` takes precedence.
</Note>

### Response

| Field | Type | Description |
|-------|------|-------------|
| `status` | string | Current parsing state (submitted, processing, completed, failed) |
| `project_id` | string | The unique project identifier |
| `progress` | number | Percentage completion (0-100) |
| `message` | string | Status description |

### Example Workflow

<CodeGroup>

```typescript TypeScript
const response = await fetch('https://production-api.potpie.ai/api/v1/parsing-status', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer <token>`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    repo_name: 'my-awesome-app',
    branch_name: 'main'
  })
});

const status = await response.json();
console.log(`Status: ${status.status}, Progress: ${status.progress}%`);
```

```python Python
import requests

response = requests.post(
    'https://production-api.potpie.ai/api/v1/parsing-status',
    headers={
        'Authorization': 'Bearer <token>',
        'Content-Type': 'application/json'
    },
    json={
        'repo_name': 'my-awesome-app',
        'branch_name': 'main'
    }
)

status = response.json()
print(f"Status: {status['status']}, Progress: {status['progress']}%")
```

```bash cURL
curl -X POST \
  'https://production-api.potpie.ai/api/v1/parsing-status' \
  -H 'Authorization: Bearer <token>' \
  -H 'Content-Type': 'application/json' \
  -d '{
    "repo_name": "my-awesome-app",
    "branch_name": "main"
  }'
```

</CodeGroup>

### Polling for Completion

```python
import time

def wait_for_parsing_by_repo(repo_name: str, branch_name: str):
    while True:
        response = requests.post(
            'https://production-api.potpie.ai/api/v1/parsing-status',
            headers={'Authorization': 'Bearer <token>'},
            json={
                'repo_name': repo_name,
                'branch_name': branch_name
            }
        )

        status = response.json()
        print(f"Status: {status['status']} - {status['progress']}%")

        if status['status'] == 'completed':
            return status
        elif status['status'] == 'failed':
            raise Exception(f"Parsing failed: {status.get('error')}")

        time.sleep(5)  # Check every 5 seconds
```

---

## Comparison: By Repo vs By Project ID

| Feature | By Repo (POST) | By Project ID (GET) |
|---------|---------------|---------------------|
| Required Info | Repo name + branch/commit | Project ID |
| HTTP Method | POST | GET |
| Use Case | Initial status check | Ongoing monitoring |
| Performance | Slightly slower | Faster |

---

## Use Case: Parse E-commerce API

**Scenario:** Parsing an e-commerce repository

<table style={{width: "100%"}}>
  <thead>
    <tr>
      <th style={{width: "15%"}}>State</th>
      <th style={{width: "30%"}}>What Happens</th>
      <th style={{width: "55%"}}>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Invoke</strong></td>
      <td>Request queued</td>
      <td>API returns <code>project_id</code></td>
    </tr>
    <tr>
      <td><strong>Processing</strong></td>
      <td>Analyzing code structure</td>
      <td>Scan <code>/app/users</code>, <code>/app/orders</code>, <code>/app/payments</code></td>
    </tr>
    <tr>
      <td><strong>Indexing</strong></td>
      <td>Building knowledge graph</td>
      <td>Map User → Order → Payment relationships</td>
    </tr>
    <tr>
      <td><strong>Completed</strong></td>
      <td>Ready for queries</td>
      <td>Ask "How does checkout work?"</td>
    </tr>
  </tbody>
</table>

---

## Complete Workflow Example

```python
import requests
import time

# 1. Start parsing
response = requests.post(
    'https://production-api.potpie.ai/api/v1/parse',
    headers={'Authorization': 'Bearer <token>'},
    json={
        'repo_name': 'my-ecommerce-api',
        'branch_name': 'main'
    }
)

project_id = response.json()['project_id']

# 2. Monitor status until complete
while True:
    status = requests.get(
        f'https://production-api.potpie.ai/api/v1/parsing-status/{project_id}',
        headers={'Authorization': 'Bearer <token>'}
    ).json()

    print(f"{status['status']}: {status['progress']}%")

    if status['status'] in ['ready', 'failed']:
        break

    time.sleep(10)

# 3. Use the parsed project
if status['status'] == 'ready':
    print(f"Project {project_id} is ready!")
```

---

## Best Practices

- **Poll every 5-10 seconds** for active monitoring
- **Implement exponential backoff** for production systems
- **Set reasonable timeouts** based on expected parsing time
- **Log progress messages** for debugging
- **Handle both success and failure cases**
- **Don't start conversations** until status is "ready"
- **Cache the project_id** once you receive it for future queries
- **Prefer the project ID endpoint** once you have the project_id

---

## Troubleshooting

<AccordionGroup>
  <Accordion title="Status stuck at 'pending'">
    The parsing queue might be busy. Wait a few minutes and check again. If it persists for more than 5 minutes, contact support.
  </Accordion>

  <Accordion title="Status shows 'failed'">
    Check the message field for details. Common causes:
    - Repository not accessible
    - Branch doesn't exist
    - Invalid repository structure
    - Parsing timeout (very large repository)
  </Accordion>

  <Accordion title="Progress not updating">
    Progress updates every 10-15 seconds. Ensure you're polling frequently enough to see changes. Some phases take longer than others.
  </Accordion>

  <Accordion title="Parsing takes too long">
    Check for very large files or excessive dependencies. Typical parsing time is 2-10 minutes for most repositories.
  </Accordion>

  <Accordion title="Incomplete parsing">
    Verify all dependencies are available and the repository structure is valid.
  </Accordion>
</AccordionGroup>

---
