---
title: 'Post Message'
openapi: 'POST /api/v1/conversations/{conversation_id}/message/'
---

## Use Cases

- Ask questions about your codebase
- Request debugging assistance
- Get explanations of code functionality
- Ask for code improvements or refactoring suggestions
- Request test generation
- Inquire about code relationships and dependencies

## Authentication

This endpoint requires API key authentication via the `x-api-key` header.

```bash
x-api-key: YOUR_API_KEY
```

<AccordionGroup>
  <Accordion title="Request & Response">

| Location | Field | Type | Required | Default | Description |
|----------|-------|------|----------|---------|-------------|
| Path | `conversation_id` | string | required | - | The unique identifier of the conversation (obtained from Create Conversation endpoint) |
| Query | `stream` | boolean | optional | `true` | Stream response in real-time. Set to `false` for complete response. |
| Query | `session_id` | string | optional | null | Session ID for reconnection to existing streaming session |
| Query | `prev_human_message_id` | string | optional | null | Previous message ID for deterministic session handling |
| Query | `cursor` | string | optional | null | Stream cursor position for replay functionality |
| Body | `content` | string | required | - | Your message or question. Cannot be empty or whitespace-only. |
| Body | `node_ids` | array[object] | optional | - | Array of specific code nodes to reference in your question |
| Body | `attachment_ids` | array[string] | optional | - | Array of uploaded attachment identifiers |
| Response | `id` | string | - | - | Unique message identifier |
| Response | `conversation_id` | string | - | - | Parent conversation ID |
| Response | `content` | string | - | - | AI agent's response content |
| Response | `type` | string | - | - | Message type (`"ai"` for agent responses, `"human"` for user messages) |
| Response | `created_at` | string | - | - | ISO 8601 timestamp |
| Response | `status` | string | - | - | Processing status: `"processing"`, `"completed"`, `"failed"` |
| Response | `citations` | array[string] | - | - | Source code references used in the response |

**NodeContext Object Structure:**
```json
{
  "node_id": "string",
  "name": "string"
}
```

**Request Body Example:**
```json
{
  "content": "How does the authentication system work?",
  "node_ids": [
    {
      "node_id": "node_123",
      "name": "auth.ts"
    }
  ],
  "attachment_ids": []
}
```

  </Accordion>
</AccordionGroup>

## Node Context

Providing `node_ids` helps the agent focus on specific parts of your codebase:

```json
{
  "content": "How does this authentication function work?",
  "node_ids": [
    {
      "node_id": "node_123",
      "name": "AuthService.authenticate"
    },
    {
      "node_id": "node_456",
      "name": "TokenValidator"
    }
  ]
}
```

<Tip>
  You can find node IDs by using the [Search Codebase](/api-reference/endpoint/search-codebase) endpoint or through the Potpie UI.
</Tip>

## Error Responses

<AccordionGroup>
  <Accordion title="400 Bad Request">

The endpoint validates that message content is not empty.

```json
{
  "detail": "Message content cannot be empty"
}
```

**Causes:**
- Empty string provided in `content` field
- Whitespace-only content
- Missing `content` field entirely

**Solution:** Provide non-empty message content:
```json
{
  "content": "How does authentication work?"
}
```
  </Accordion>

  <Accordion title="401 Unauthorized">

The endpoint requires a valid API key for authentication.

```json
{
  "detail": "API key is required"
}
```

**Causes:**
- Missing `x-api-key` header
- Invalid or expired API key

**Solution:** Include a valid API key in the request header.
  </Accordion>

  <Accordion title="402 Payment Required">

The endpoint returns this error when you have exceeded your plan's usage limits.

```json
{
  "detail": "Subscription required to create a conversation."
}
```

**Causes:**
- Message limit exceeded for your current plan
- Subscription has expired

**Solution:** Upgrade your subscription plan or wait for limits to reset.
  </Accordion>

  <Accordion title="404 Not Found">

The endpoint returns this error when the conversation doesn't exist or you lack access.

```json
{
  "detail": "Conversation not found"
}
```

**Causes:**
- Invalid `conversation_id` in URL path
- Conversation was deleted
- You don't have access to this conversation

**Solution:** Verify the conversation ID and ensure you have proper access permissions.
  </Accordion>

  <Accordion title="500 Internal Server Error">

The endpoint returns this error when unexpected exceptions occur during message processing.

```json
{
  "detail": "Internal server error"
}
```

**Causes:**
- Celery worker unavailable for message processing
- Database connection failures
- Invalid node IDs or attachment IDs

**Solution:** Retry the request after a brief delay. Verify all node IDs and attachment IDs are valid.
  </Accordion>
</AccordionGroup>

## Complete Workflow

<CodeGroup>

```typescript TypeScript
const response = await fetch(
  'https://production-api.potpie.ai/api/v1/conversations/conv_789/message?stream=false',
  {
    method: 'POST',
    headers: {
      'x-api-key': 'YOUR_API_KEY',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      content: 'How does the authentication flow work in this codebase?',
      node_ids: [],
      attachment_ids: []
    })
  }
);

const data = await response.json();
console.log('Response:', data.content);
```

```python Python
import requests

# Send message referencing specific code nodes
response = requests.post(
    f'https://production-api.potpie.ai/api/v1/conversations/conv_789/message',
    params={'stream': False},
    headers={
        'x-api-key': 'YOUR_API_KEY',
        'Content-Type': 'application/json'
    },
    json={
        'content': 'Can you explain how these components interact?',
        'node_ids': [
            {
                'node_id': 'node_123',
                'name': 'AuthService'
            },
            {
                'node_id': 'node_456',
                'name': 'UserController'
            }
        ],
        'attachment_ids': []
    }
)

result = response.json()
print(f"Response: {result['content']}")
```

```bash cURL
curl -X POST \
  'https://production-api.potpie.ai/api/v1/conversations/conv_789/message?stream=false' \
  -H 'x-api-key: YOUR_API_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "content": "How does authentication work?",
    "node_ids": [],
    "attachment_ids": []
  }'
```

</CodeGroup>

## Message Types

Different message patterns for different tasks:

### Question & Answer

```
"What does the parseUserData function do?"
"Where is the JWT token validated?"
"How are database migrations handled?"
```

### Debugging

```
"I'm getting 'TypeError: Cannot read property...' in UserService"
"Why is the authentication failing for OAuth users?"
"The cache is not invalidating properly, can you investigate?"
```

### Code Review

```
"Review the error handling in the payment service"
"Is the API endpoint properly secured?"
"Suggest improvements for the authentication middleware"
```

### Test Generation

```
"Generate unit tests for the UserService class"
"What edge cases should I test for the payment flow?"
"Create integration tests for the authentication endpoints"
```

## Response Streaming

For real-time responses, agents may stream their output. The message status will update as the agent processes:

1. **processing**: Agent is analyzing your question
2. **ready**: Response is ready
3. **failed**: An error occurred

<Note>
**Rate Limits:**
- Maximum message length: 10,000 characters
- Rate limit: 10 messages per minute per conversation
- Maximum concurrent conversations: 5 per user
</Note>

