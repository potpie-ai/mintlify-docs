---
title: 'Confluence Integration'
description: 'Connect Potpie with Confluence to manage documentation and knowledge bases'
---

## Overview

The Confluence integration enables Potpie agents to interact with your Confluence workspace using Atlassian OAuth 2.0 (3LO), providing access to spaces, pages, and content management.

<CardGroup cols={2}>
  <Card title="7 Tools" icon="toolbox">
    Read, search, create, and update Confluence pages
  </Card>
  <Card title="Atlassian 3LO" icon="shield-check">
    Secure OAuth 2.0 with cloud ID support
  </Card>
  <Card title="CQL Search" icon="magnifying-glass">
    Powerful Confluence Query Language search
  </Card>
  <Card title="Multi-Space" icon="folders">
    Access multiple spaces and pages
  </Card>
</CardGroup>

---

## Quick Start

<Steps>
  <Step title="Create Atlassian OAuth App">
    Go to [Atlassian Developer Console](https://developer.atlassian.com/console/myapps/)

    Create OAuth 2.0 integration:
    - **App name**: Potpie AI
    - **Callback URL**: `https://app.potpie.ai/integrations/confluence/callback`
    - **Permissions**: See scopes below
  </Step>

  <Step title="Configure Environment">
    ```bash
    # Can reuse Jira credentials if same Atlassian account
    CONFLUENCE_CLIENT_ID=your_client_id
    CONFLUENCE_CLIENT_SECRET=your_client_secret
    CONFLUENCE_OAUTH_SCOPE="write:confluence-content read:confluence-space.summary ... offline_access"
    ```
  </Step>

  <Step title="Connect Confluence Site">
    1. Settings → Integrations → Confluence
    2. Click "Connect"
    3. Select your Confluence site
    4. Authorize permissions
    5. Name the integration
  </Step>

  <Step title="Test Integration">
    *"List all Confluence spaces"*

    *"Search Confluence for 'API documentation'"*
  </Step>
</Steps>

---

## OAuth Setup

### Atlassian OAuth 2.0 (3LO)

**Authorization URL**: `https://auth.atlassian.com/authorize`
**Token URL**: `https://auth.atlassian.com/oauth/token`
**API Base**: `https://api.atlassian.com/ex/confluence/{cloud_id}`

### Required Scopes

```
write:confluence-content         # Create/update pages
read:confluence-space.summary    # Read space info
write:confluence-space           # Manage spaces
write:confluence-file            # Upload attachments
read:confluence-props            # Read properties
write:confluence-props           # Write properties
read:confluence-content.all      # Read all content
read:confluence-content.summary  # Read summaries
search:confluence                # Search (CQL)
read:confluence-content.permission # Read permissions
read:confluence-user             # Read user info
read:confluence-groups           # Read groups
readonly:content.attachment:confluence # Read attachments
read:space:confluence            # Read spaces
read:page:confluence             # Read pages
write:page:confluence            # Write pages
write:comment:confluence         # Write comments
read:content-details:confluence  # Read details
offline_access                   # Refresh tokens
```

### Cloud ID

Same as Jira - fetch accessible resources after OAuth:
```bash
GET https://api.atlassian.com/oauth/token/accessible-resources
Authorization: Bearer {access_token}
```

---

## Available Tools

### 1. Get Confluence Spaces

**Tool**: `get_confluence_spaces_tool`

**Usage**:
```
"List all Confluence spaces"
"Show me available Confluence workspaces"
```

**Returns**: Space keys, names, types (global/personal)

### 2. Get Confluence Page

**Tool**: `get_confluence_page_tool`

**Usage**:
```
"Get Confluence page with ID 123456"
"Show me page content for page ID 789"
```

**Returns**: Title, body content, version, space, creator

### 3. Get Space Pages

**Tool**: `get_confluence_space_pages_tool`

**Usage**:
```
"List all pages in Confluence space DOCS"
"Show pages in ENG space"
```

**Returns**: Page list with titles, IDs, creation dates

### 4. Search Confluence Pages

**Tool**: `search_confluence_pages_tool`

**Usage**:
```
"Search Confluence for 'API documentation'"
"Find pages about authentication in Confluence"
```

**CQL Examples**:
```cql
text ~ "authentication"
space = DOCS AND type = page
title ~ "API" AND lastModified >= now("-7d")
creator = currentUser() AND space in (DOCS, ENG)
```

### 5. Create Confluence Page

**Tool**: `create_confluence_page_tool`

**Usage**:
```
"Create Confluence page in DOCS space: 'API Guidelines'"
"Add new page to ENG space with title 'Setup Guide'"
```

**Parameters**:
- Space key (required)
- Title (required)
- Content (storage format or plain text)
- Parent page ID (optional)

### 6. Update Confluence Page

**Tool**: `update_confluence_page_tool`

**Usage**:
```
"Update Confluence page 123456 with new content"
"Change title of page ID 789 to 'Updated Guide'"
```

**Version Management**: Automatically increments version number

### 7. Add Comment

**Tool**: `add_confluence_comment_tool`

**Usage**:
```
"Add comment to Confluence page 123456: 'Needs review'"
"Comment on page ID 789: 'Updated with latest info'"
```

---

## Usage Examples

### Search Documentation

**Query**: *"Search Confluence for all pages about OAuth implementation"*

**Response**:
```markdown
## Confluence Search Results

Found 5 pages matching "OAuth implementation":

### 1. OAuth 2.0 Implementation Guide
- **Space**: DOCS
- **Last Modified**: 2 days ago
- **Author**: @alice
- **URL**: https://yoursite.atlassian.net/wiki/spaces/DOCS/pages/123456

### 2. OAuth Flow Diagrams
- **Space**: ENG
- **Last Modified**: 1 week ago
- **Author**: @bob
- **URL**: https://yoursite.atlassian.net/wiki/spaces/ENG/pages/123457

### 3. OAuth Security Best Practices
- **Space**: SECURITY
- **Last Modified**: 2 weeks ago
- **Author**: @security-team
- **URL**: https://yoursite.atlassian.net/wiki/spaces/SECURITY/pages/123458
```

### Create Documentation Page

**Query**: *"Create a Confluence page in DOCS space documenting the new API endpoints"*

**Response**:
```markdown
✅ Created Confluence Page

**Title**: API Endpoints Documentation
**Space**: DOCS
**Page ID**: 987654
**URL**: https://yoursite.atlassian.net/wiki/spaces/DOCS/pages/987654

**Content**:
# API Endpoints Documentation

## Overview
This page documents all available API endpoints for the Potpie integration.

## Authentication
All endpoints require Bearer token authentication.

## Endpoints

### POST /api/v1/parse
Parses a repository and builds knowledge graph.

**Request**:
```json
{
  "repo_name": "owner/repo",
  "branch_name": "main"
}
```

**Response**:
```json
{
  "project_id": "proj_123",
  "status": "parsing"
}
```

---

Page created successfully. You can now:
1. Add more content
2. Attach files
3. Set page permissions
4. Link to other pages
```

### Update Existing Page

**Query**: *"Update Confluence page 123456 to add a troubleshooting section"*

**Response**:
```markdown
✅ Updated Confluence Page 123456

**Previous Version**: v5
**New Version**: v6
**Changes**: Added troubleshooting section

**Added Content**:

## Troubleshooting

### Issue: Integration not connecting
**Solution**: Check OAuth credentials and permissions

### Issue: Page not found
**Solution**: Verify page ID and access permissions

---

**Change Summary**:
- Added troubleshooting section
- Included 2 common issues with solutions
- Updated last modified timestamp

**URL**: https://yoursite.atlassian.net/wiki/spaces/DOCS/pages/123456
```

---

## Storage Format

Confluence uses its own storage format for content:

### Simple HTML-like Format
```html
<p>Hello world!</p>
<p>This is <strong>bold</strong> and <em>italic</em> text.</p>

<h2>Heading 2</h2>
<ul>
  <li>Item 1</li>
  <li>Item 2</li>
</ul>

<ac:structured-macro ac:name="code">
  <ac:plain-text-body><![CDATA[
    console.log('Hello');
  ]]></ac:plain-text-body>
</ac:structured-macro>
```

### Potpie Auto-Conversion
Potpie automatically converts:
- Markdown → Confluence storage format
- Plain text → Formatted content
- Code blocks → Code macros

---

## CQL (Confluence Query Language)

### Basic Syntax

```cql
# Search by text
text ~ "authentication"

# Filter by space
space = DOCS

# Filter by type
type = page

# Combine conditions
space = DOCS AND type = page AND text ~ "API"

# Date filters
lastModified >= "2024-01-01"
created >= now("-7d")

# User filters
creator = currentUser()
contributor = "john@company.com"

# Sort results
order by lastModified desc
```

### Advanced Examples

```cql
# Recent pages in multiple spaces
space in (DOCS, ENG) AND lastModified >= now("-30d")

# Pages with specific label
label = "api-docs" AND space = DOCS

# My recent edits
contributor = currentUser() AND lastModified >= now("-7d")

# Popular pages
space = DOCS AND type = page ORDER BY lastModified desc
```

---

## Webhook Support

<Warning>
  Confluence OAuth 2.0 apps **cannot** register webhooks via API. Webhooks are only available for Atlassian Connect apps.
</Warning>

**Alternative**: Use Confluence's built-in automation rules to trigger external webhooks for page events.

---

## Troubleshooting

<AccordionGroup>
  <Accordion title="Integration Not Found" icon="circle-xmark">
    **Solution**:
    1. Check integration status
    2. Reconnect if expired
    3. Verify environment variables
  </Accordion>

  <Accordion title="Page Not Found" icon="file-circle-xmark">
    **Solution**:
    - Verify page ID is correct
    - Check space permissions
    - Ensure page isn't archived
  </Accordion>

  <Accordion title="Insufficient Permissions" icon="lock">
    **Solution**:
    1. Review required scopes
    2. Revoke and reconnect
    3. Grant space permissions
  </Accordion>

  <Accordion title="Content Format Error" icon="code">
    **Solution**:
    - Use plain text (auto-converted)
    - Check storage format syntax
    - Validate macros format
  </Accordion>
</AccordionGroup>

---

## API Reference

### Endpoints

**Base**: `/api/v2/integrations/confluence`

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/oauth/authorize` | Start OAuth |
| GET | `/oauth/callback` | Handle callback |
| POST | `/save` | Save integration |
| GET | `/status/{user_id}` | Check status |

### Save Integration

```json
POST /api/v2/integrations/confluence/save
{
  "code": "oauth_code",
  "redirect_uri": "https://app.potpie.ai/integrations/confluence/callback",
  "instance_name": "My Confluence",
  "user_id": "user_123",
  "integration_type": "confluence",
  "timestamp": "2024-02-17T10:00:00Z"
}
```

---

## Best Practices

<AccordionGroup>
  <Accordion title="Content Organization" icon="folder-tree">
    - Use clear space names
    - Organize pages hierarchically
    - Add labels for categorization
    - Link related pages
    - Keep titles descriptive
  </Accordion>

  <Accordion title="Search Optimization" icon="magnifying-glass">
    - Use specific CQL queries
    - Filter by space first
    - Add relevant labels
    - Use descriptive titles
    - Include keywords in content
  </Accordion>

  <Accordion title="Version Control" icon="clock-rotate-left">
    - Review version history
    - Add change comments
    - Use page restrictions
    - Back up important pages
    - Monitor page changes
  </Accordion>
</AccordionGroup>

---

## Support

<CardGroup cols={2}>
  <Card title="Confluence API" icon="book" href="https://developer.atlassian.com/cloud/confluence/rest/v2/intro/">
    Official Confluence REST API v2
  </Card>
  <Card title="CQL Reference" icon="code" href="https://developer.atlassian.com/cloud/confluence/cql/">
    Confluence Query Language guide
  </Card>
  <Card title="Storage Format" icon="file-code" href="https://confluence.atlassian.com/doc/confluence-storage-format-790796544.html">
    Content storage format docs
  </Card>
  <Card title="Support" icon="life-ring" href="mailto:hi@potpie.ai">
    Contact Potpie support
  </Card>
</CardGroup>

---

## What's Next?

<CardGroup cols={2}>
  <Card title="Jira Integration" icon="puzzle-piece" href="/extensions/jira">
    Connect Confluence with Jira
  </Card>
  <Card title="GitHub Integration" icon="github" href="/extensions/github">
    Link docs to GitHub repos
  </Card>
  <Card title="Custom Agents" icon="robot" href="/custom-agents/introduction">
    Build agents with Confluence tools
  </Card>
  <Card title="Ask Agent" icon="messages-question" href="/agents/qna-agent">
    Query Confluence knowledge base
  </Card>
</CardGroup>
