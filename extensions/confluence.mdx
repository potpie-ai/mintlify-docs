---
title: 'Confluence Integration'
description: 'Connect Potpie with Confluence to manage documentation and knowledge bases'
---

## Overview

The Confluence integration enables Potpie agents to interact with Confluence workspaces using Atlassian OAuth 2.0 (3LO), providing access to spaces, pages, and content management.

<CardGroup cols={2}>
  <Card title="7 Tools" icon="toolbox">
    Read, search, create, and update Confluence pages
  </Card>
  <Card title="Atlassian 3LO" icon="shield-check">
    Secure OAuth 2.0 with cloud ID support
  </Card>
  <Card title="CQL Search" icon="magnifying-glass">
    Powerful Confluence Query Language search
  </Card>
  <Card title="Multi-Space" icon="folders">
    Access multiple spaces and pages
  </Card>
</CardGroup>

---

## Quick Start

<Steps>
  <Step title="Create Atlassian OAuth App">
    Go to [Atlassian Developer Console](https://developer.atlassian.com/console/myapps/)

    Create OAuth 2.0 integration:
    - **App name**: Potpie AI
    - **Callback URL**: `https://app.potpie.ai/integrations/confluence/callback`
    - **Permissions**: See scopes below
  </Step>

  <Step title="Configure Environment">
    ```bash
    # Can reuse Jira credentials if same Atlassian account
    CONFLUENCE_CLIENT_ID=your_client_id
    CONFLUENCE_CLIENT_SECRET=your_client_secret
    CONFLUENCE_OAUTH_SCOPE="write:confluence-content read:confluence-space.summary ... offline_access"
    ```
  </Step>

  <Step title="Connect Confluence Site">
    1. Settings → Integrations → Confluence
    2. Click "Connect"
    3. Select the Confluence site
    4. Authorize permissions
    5. Name the integration
  </Step>

  <Step title="Test Integration">
    *"List all Confluence spaces"*

    *"Search Confluence for 'API documentation'"*
  </Step>
</Steps>

---

## OAuth Setup

### Atlassian OAuth 2.0 (3LO)

**Authorization URL**: `https://auth.atlassian.com/authorize`
**Token URL**: `https://auth.atlassian.com/oauth/token`
**API Base**: `https://api.atlassian.com/ex/confluence/{cloud_id}`

### Required Scopes

```
write:confluence-content         # Create/update pages
read:confluence-space.summary    # Read space info
write:confluence-space           # Manage spaces
write:confluence-file            # Upload attachments
read:confluence-props            # Read properties
write:confluence-props           # Write properties
read:confluence-content.all      # Read all content
read:confluence-content.summary  # Read summaries
search:confluence                # Search (CQL)
read:confluence-content.permission # Read permissions
read:confluence-user             # Read user info
read:confluence-groups           # Read groups
readonly:content.attachment:confluence # Read attachments
read:space:confluence            # Read spaces
read:page:confluence             # Read pages
write:page:confluence            # Write pages
write:comment:confluence         # Write comments
read:content-details:confluence  # Read details
offline_access                   # Refresh tokens
```

### Cloud ID

Same as Jira - fetch accessible resources after OAuth:
```bash
GET https://api.atlassian.com/oauth/token/accessible-resources
Authorization: Bearer {access_token}
```

---

## Available Tools

### 1. Get Confluence Spaces

**Tool**: `get_confluence_spaces_tool`

**Usage**:
```
"List all Confluence spaces"
"Show me available Confluence workspaces"
```

**Returns**: Space keys, names, types (global/personal)

### 2. Get Confluence Page

**Tool**: `get_confluence_page_tool`

**Usage**:
```
"Get Confluence page with ID 123456"
"Show me page content for page ID 789"
```

**Returns**: Title, body content, version, space, creator

### 3. Get Space Pages

**Tool**: `get_confluence_space_pages_tool`

**Usage**:
```
"List all pages in Confluence space DOCS"
"Show pages in ENG space"
```

**Returns**: Page list with titles, IDs, creation dates

### 4. Search Confluence Pages

**Tool**: `search_confluence_pages_tool`

**Usage**:
```
"Search Confluence for 'API documentation'"
"Find pages about authentication in Confluence"
```

**CQL Examples**:
```cql
text ~ "authentication"
space = DOCS AND type = page
title ~ "API" AND lastModified >= now("-7d")
creator = currentUser() AND space in (DOCS, ENG)
```

### 5. Create Confluence Page

**Tool**: `create_confluence_page_tool`

**Usage**:
```
"Create Confluence page in DOCS space: 'API Guidelines'"
"Add new page to ENG space with title 'Setup Guide'"
```

### 6. Update Confluence Page

**Tool**: `update_confluence_page_tool`

**Usage**:
```
"Update Confluence page 123456 with new content"
"Change title of page ID 789 to 'Updated Guide'"
```

**Version Management**: Automatically increments version number

### 7. Add Comment

**Tool**: `add_confluence_comment_tool`

**Usage**:
```
"Add comment to Confluence page 123456: 'Needs review'"
"Comment on page ID 789: 'Updated with latest info'"
```

---

## Storage Format

Confluence uses its own storage format for content:

### Simple HTML-like Format
```html
<p>Hello world!</p>
<p>This is <strong>bold</strong> and <em>italic</em> text.</p>

<h2>Heading 2</h2>
<ul>
  <li>Item 1</li>
  <li>Item 2</li>
</ul>

<ac:structured-macro ac:name="code">
  <ac:plain-text-body><![CDATA[
    console.log('Hello');
  ]]></ac:plain-text-body>
</ac:structured-macro>
```

### Potpie Auto-Conversion
Potpie automatically converts:
- Markdown → Confluence storage format
- Plain text → Formatted content
- Code blocks → Code macros

---

## CQL (Confluence Query Language)

### Basic Syntax

```cql
# Search by text
text ~ "authentication"

# Filter by space
space = DOCS

# Filter by type
type = page

# Combine conditions
space = DOCS AND type = page AND text ~ "API"

# Date filters
lastModified >= "2024-01-01"
created >= now("-7d")

# User filters
creator = currentUser()
contributor = "john@company.com"

# Sort results
order by lastModified desc
```

### Advanced Examples

```cql
# Recent pages in multiple spaces
space in (DOCS, ENG) AND lastModified >= now("-30d")

# Pages with specific label
label = "api-docs" AND space = DOCS

# My recent edits
contributor = currentUser() AND lastModified >= now("-7d")

# Popular pages
space = DOCS AND type = page ORDER BY lastModified desc
```

---

## Webhook Support

<Warning>
  Confluence OAuth 2.0 apps **cannot** register webhooks via API. Webhooks are only available for Atlassian Connect apps.
</Warning>

**Alternative**: Use Confluence's built-in automation rules to trigger external webhooks for page events.

---

## API Reference

### Endpoints

**Base**: `/api/v2/integrations/confluence`

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/oauth/authorize` | Start OAuth |
| GET | `/oauth/callback` | Handle callback |
| POST | `/save` | Save integration |
| GET | `/status/{user_id}` | Check status |

### Save Integration

```json
POST /api/v2/integrations/confluence/save
{
  "code": "oauth_code",
  "redirect_uri": "https://app.potpie.ai/integrations/confluence/callback",
  "instance_name": "My Confluence",
  "user_id": "user_123",
  "integration_type": "confluence",
  "timestamp": "2024-02-17T10:00:00Z"
}
```

---

## What's Next?

<CardGroup cols={2}>
  <Card title="Jira Integration" icon="puzzle-piece" href="/extensions/jira">
    Connect Confluence with Jira
  </Card>
  <Card title="GitHub Integration" icon="github" href="/extensions/github">
    Link docs to GitHub repos
  </Card>
  <Card title="Custom Agents" icon="robot" href="/custom-agents/introduction">
    Build agents with Confluence tools
  </Card>
  <Card title="Ask a Question" icon="messages-question" href="/build-flow/ask-a-question">
    Query Confluence knowledge base
  </Card>
</CardGroup>
